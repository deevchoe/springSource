<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Vue REST</title>
<style type="text/css">
table {
	width: 90%;
	border-collapse:collapse; 
}
th, td{
	border: 1px solid #ddd;
	padding: 8px;
	text-align: center;
}
th {
	background-color: #f2f2f2;
}
</style>

<script src="https://unpkg.com/vue@3"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
<div id="app">
<h2>ğŸªª íšŒì› ì •ë³´</h2>
<table>
	<thead>
		<tr>
			<th>ë²ˆí˜¸</th><th>ì´ë¦„</th><th>ì£¼ì†Œ</th><th>ìˆ˜ì •/ì‚­ì œ</th>
		</tr>
	</thead>
	<tbody>
		<tr v-for="member in members" :key="member.num">
			<td>{{ member.num }}</td>
			<td>{{ member.name }}</td>
			<td>{{ member.addr }}</td>
			<td>
				<button @click="selectMember(member)">ìˆ˜ì •</button>
				<button @click="deleteMember(member.num)">ì‚­ì œ</button>
			</td>
		</tr>
	</tbody>
</table>

<h2>â“ì¶”ê°€ë„ í•˜Go~ ìˆ˜ì •ë„ í•˜Go~â—</h2>
<form @submit.prevent="saveMember">
	<input v-model="memberForm.name" placeholder="ì´ë¦„ ì…ë ¥" required><br/>
	<input v-model="memberForm.addr" placeholder="ì£¼ì†Œ ì…ë ¥" required><br/>
	<button type="submit">íšŒì› {{memberForm.num?'ìˆ˜ì •':'ì¶”ê°€'}}</button>
	<!-- num ê°’ì— ë”°ë¼ ìˆ˜ì • ë˜ëŠ” ì¶”ê°€ -->
</form>
</div>

<script type="text/javascript">
const {createApp, ref, onMounted} = Vue;	// createApp, ref, onMounted ì–˜ë„¤ ì–´ë””ì„œ ê°€ì ¸ì˜¬ê±°ì•¼~? Vueì—ì„œ

createApp({
	setup(){
		const members = ref([]);
		// ë°˜ì‘í˜• ë°ì´í„°ë¡œ ë™ì‘ : ì € ì•ˆì— ìˆëŠ” ì• ë“¤ì´ Vue ì»´í¬ë„ŒíŠ¸ì—ì„œ ë³€ê²½ë  ë•Œ ìë™ ì¶”ì ë¨. UIë¥¼ ì¬ë Œë”ë§. 
		const memberForm = ref({num:null, name:'', addr:''});
		
		// ìë£Œë¥¼ ì½ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜
		const fetchNumbers = async() => {
			const response = await axios.get('/members');	// MemberControllerì˜ GetMapping membersë¥¼ ë§Œë‚˜ê² ë„¹
			members.value = response.data;
		};
		
		// íšŒì› ì •ë³´ ì €ì¥ (ìˆ˜ì • ë˜ëŠ” ì¶”ê°€)í•˜ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜
		const saveMember = async() => {
			if(memberForm.value.num){
				// memberForm.value.num ê°’ì´ ìˆìœ¼ë©´ íšŒì›ì„ ìˆ˜ì •
				await axios.put(`/members/${memberForm.value.num}`, memberForm.value); // ìˆ˜ì •ì´ë‹ˆê¹ put!
			}else{
				// memberForm.value.num ê°’ì´ ì—†ìœ¼ë©´ íšŒì›ì„ ì¶”ê°€
				await axios.post('/members', memberForm.value); // ìˆ˜ì •ì´ë‹ˆê¹ put!
			}

			// ìœ„ ì‘ì—… í›„ ì…ë ¥ ìë£Œ (í¼) ì§€ìš°ê¸°
			memberForm.value = {num:null, name:'', addr:''};
			
			fetchNumbers();	// ìˆ˜ì • ë˜ëŠ” ì¶”ê°€ í›„ ëª©ë¡ ë³´ê¸°
		};
		
		// íšŒì› ì‚­ì œ ë¹„ë™ê¸° í•¨ìˆ˜
		const deleteMember = async(num) => {	// asyncì— numì´ ë„˜ì–´ì˜¤ê²Œ?
			await axios.delete(`members/${num}`);
			fetchNumbers();	// ì‚­ì œ í›„ ëª©ë¡ ë³´ê¸°
		};
		
		const selectMember = (member) => {
			memberForm.value = {...member};
		}
		
		onMounted(fetchNumbers);	// ì»´í¬ë„ŒíŠ¸ê°€ Mountë˜ë©´ fetchNumbers í˜¸ì¶œ
		
		return {members, memberForm, saveMember, deleteMember, selectMember};
	}
}).mount('#app');
</script>
</body>
</html>